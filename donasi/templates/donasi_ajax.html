{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>To Do List</title>
{% endblock meta %}


{% block content %}
<style>
    h1{
      text-align: center;
      font-weight: bold;
      padding-top: 20px;
    }
    h4, p{
      text-align: center;
      font-weight: bold;
    }
    .card {
      box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
      width: 50%;
      max-height: 1000px;
      display: inline-block;
      margin: 20px 29px;
      background-color: #38914a;
      border-radius: 15px;

      
    }
    
    .card:hover {
      box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
    }
    
    .container {
      padding: 50px 10px;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
      width: 30%;
    }
    button{
      background-color: #73AD21;
      text-decoration: none;
      border-radius: 15px;
      border: 2px solid #73AD21;
      padding: 5px;
      width: 100px;
      height: 60px;
    }
    #tombol-delete{
      border-radius: 25px;
      width: 100px;
      height: 50px;
      color: black;
    }

    a { 
      text-decoration: none; 
      color: white;
    }
 </style>

<h1>List Donasi</h1>

<div id="cards_ajax"></div>
<br></br>

<center>
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@getbootstrap">Donasi</button>
</center>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">New Donasi</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="formtask">
          {% csrf_token %}
          <div class="mb-3">
            <label for="recipient-name" class="col-form-label">Nama:</label>
            <input type="text" class="form-control" id="field_name" name="name">
          </div>
          <div class="mb-3">
            <label for="message-text" class="col-form-label">Nominal:</label>
            <textarea class="form-control" id="field_amount" name="amount"></textarea>
          </div>
          <div class="mb-3">
            <label for="message-text" class="col-form-label">Tujuan Donasi:</label>
            <textarea class="form-control" id="field_target" name="target"></textarea>
          </div>
        </form>
      </div>
        <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="addtaskbutton" data-bs-dismiss="modal">Add</button>
      </div>
    </div>
  </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>

async function getDonasiList() {
    return fetch("{% url 'donasi:show_json' %}").then((res) => res.json())
}

async function refreshDonasiList() {
        document.getElementById("cards_ajax").innerHTML = ""
        const donasiList = await getDonasiList()
        let htmlString = ``
        donasiList.forEach((item) => {
        htmlString += `\n
        <center>
        <div class="card">
            <div class="container">
                <h4><b>Nama Donatur</b></h4>
                <p>${item.fields.name}</p>
                <h4><b>Nominal</b></h4>
                <p>Rp${item.fields.amount}</p>
                <h4><b>Tujuan Donasi</b></h4>
                <p>${item.fields.target}</p>
                <h4><b>Tanggal</b></h4>
                <p>${item.fields.date}</p>
                <button type="button" id="tombol-delete">
                  <a class="link" onclick="deleteTask(${item.pk})">Submit</a>
                </button>
            </div>
        </div>
        </center>
        ` 
        })
        document.getElementById("cards_ajax").innerHTML = htmlString
}
async function deleteTask(id) {
    let url = "/donasi/json/delete/" + id;
    fetch(url).then(refreshDonasiList)
  }

function addDonasi() {
    fetch("{% url 'donasi:add_donasi_ajax' %}", {
        method: "POST",
        body: new FormData(document.querySelector('#formtask'))
    }).then(refreshDonasiList)
    return false
}

document.getElementById("addtaskbutton").onclick = addDonasi
refreshDonasiList()
</script>

{% endblock content %}